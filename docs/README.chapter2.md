# 第二章 ⇨ 关系型数据库系统的基础理论

- [☝ 回到首页](https://github.com/Lvsi-China/Sherk)
- [第一章 ⇨ Sherk 使用手册](https://github.com/Lvsi-China/Sherk/blob/master/docs/README.chapter1.md)
- [第三章 ⇨ 关系型数据库系统的代码实现（Sherk 源码）](https://github.com/Lvsi-China/Sherk/blob/master/docs/README.chapter3.md)
- [第四章 ⇨ 思考和总结](https://github.com/Lvsi-China/Sherk/blob/master/docs/README.chapter4.md)
- [附录](https://github.com/Lvsi-China/Sherk/blob/master/docs/README.appendix.md)

<br/>


# <span id="article-index">索引</span>

## 1. 前言
- [1.1 图解数据库](#article-1.1)

- [1.2 数据库的发展历史](#article-1.2)

- 1.3 数据库的4个基本概念

    - [1.3.1 数据](#article-1.3.1)
    - [1.3.2 数据库](#article-1.3.2)
    - [1.3.3 数据库管理系统](#article-1.3.3)
    - [1.3.4 数据库系统](#article-1.3.4)

## 2. 深入理解数据库系统

- 2.1 数据模型的概念

    - [2.1.1 什么是数据模型](#article-2.1.1)

    - 2.1.2 数据模型的组成 3 要素

        - [数据结构](#article-2.1.2.1)
        - [数据操作](#article-2.1.2.2)
        - [数据的完整性约束条件](#article-2.1.2.3)

    - 2.1.3 两类数据模型

        - [概念数据模型](#article-2.1.3.1)
        - [物理数据模型](#article-2.1.3.2)

    - 2.1.4 概念数据模型

        - [实体](#article-2.1.4.1)
        - [属性](#article-2.1.4.2)
        - [码](#article-2.1.4.3)
        - [实体型](#article-2.1.4.4)
        - [实体集](#article-2.1.4.5)
        - [联系](#article-2.1.4.6)

   - 2.1.5 三种重要的物理数据模型

        - [层次模型](#article-2.1.5.1)
        - [网状模型](#article-2.1.5.2)
        - [关系模型](#article-2.1.5.3)

- 2.2 基于不同物理数据模型的3种数据库系统
    - [2.2.1 层次数据库系统 - 基于层次模型](#article-2.2.1)
    - [2.2.2 网状数据库系统 - 基于网状模型](#article-2.2.2)
    - [2.2.3 关系数据库系统 - 基于关系模型](#article-chapter-4)

- 2.3 数据库系统的三级模式概述及结构
    - [2.3.1 概述](#article-2.3.1)
    - [2.3.2 外模式](#article-2.3.2)
    - [2.3.3 模式](#article-2.3.3)
    - [2.3.4 内模式](#article-2.3.4)

- 2.4 数据库系统的特点

- 2.5 常用的数据库系统分类
    - [2.5.1 关系型数据库](#article-2.5.1)
    - [2.5.2 非关系型数据库（NoSQL）](#article-2.5.2)


## 3. <span id="article-chapter-3">非关系型数据库系统简介</span>

- [3.1 概述](#article-3.1)
- [3.2 非关系型数据库的特点](#article-3.2)
- [3.3 常用的非关系型数据库](#article-3.3)

## 4. <span id="article-chapter-4">深入理解关系型数据库系统</span>

- 4.1 关系的基础概念

    - [4.1.1 定义](#article-4.1.1)

    - [4.1.2 如何理解关系](#article-4.1.2)

    - 4.1.3 重要的三个组成

        - [关系数据结构](#article-4.1.3.1)
        - [关系操作集合](#article-4.1.3.2)
        - [关系完整性约束](#article-4.1.3.3)

    - 4.1.4 关系模式的数据理论

        - [什么是关系模式](#article-4.1.4.1)

        - 好的关系模式应具有的特点

            - [数据冗余少](#article-4.1.4.2.1)
            - [插入正常](#article-4.1.4.2.2)
            - [更新正常](#article-4.1.4.2.3)
            - [删除正常](#article-4.1.4.2.4)

        - 规范化（关系模式的模式分解）
            - [函数依赖](#article-4.1.4.3.1)
            - [码](#article-4.1.4.3.2)
            - [范式](#article-4.1.4.3.3)
            - [2NF](#article-4.1.4.3.4)
            - [3NF](#article-4.1.4.3.5)
            - [BCNF](#article-4.1.4.3.6)
            - [多值依赖](#article-4.1.4.3.7)
            - [4NF](#article-4.1.4.3.8)

- 4.2 关系的完整性
    - [4.2.1 概述](#article-4.2.1)
    - [4.2.2 实体完整性](#article-4.2.2)
    - [4.2.3 参照完整性](#article-4.2.3)
    - [4.2.4 自定义完整性](#article-4.2.4)

- 4.3 关系的代数运算
    - [4.3.1 集合运算](#article-4.3.1)

    - 4.3.2 关系运算
        - [选择](#article-4.3.2.1)
        - [投影](#article-4.3.2.2)
        - [连接](#article-4.3.2.3)
        - [除](#article-4.3.2.4)



## 5. 关系型数据库系统的理论架构

- #### 5.1 完整性

    - [5.1.1 概述](#article-5.1.1)
    - [5.1.2 实体完整性](#article-5.1.2)
    - [5.1.3 参照完整性](#article-5.1.3)
    - [5.1.4 自定义完整性](#article-5.1.4)
    - [5.1.5 断言（Assertion）](#article-5.1.5)

- #### 5.2 数据存储

    - [5.2.1 概述](#article-5.2.1)
    - [5.2.2 磁盘存储](#article-5.2.2)
    - 5.2.3 内存缓存

        - [缓存池](#article-5.2.3.1)

- #### 5.3 数据索引

    - [5.3.1 概述](#article-5.3.1)
    - [5.3.2 索引的分类](#article-5.3.2)

    - 5.3.3 索引的实现原理

        - [B 树索引](#article-5.3.3.1)
        - [B+ 树索引](#article-5.3.3.2)
        - [Hash 索引](#article-5.3.3.3)

- #### 5.4 查询处理

    - [5.4.1 概述](#article-5.4.1)

    - 5.4.2 查询步骤

        - [查询分析](#article-5.4.2.1)
        - [查询检查](#article-5.4.2.2)
        - [查询优化](#article-5.4.2.3)
        - [查询执行](#article-5.4.2.4)

    - [5.4.3 理解查询计划](#article-5.4.3)

    - 5.4.4 理解查询优化

        - [查询优化概述](#article-5.4.4.1)
        - [实例讲解](#article-5.4.4.2)
        - [优化方法](#article-5.4.4.3)

- #### 5.5 日志系统

- #### 5.6 事务处理

    - ##### 5.6.1 事务

        - [概述](#article-5.6.1.1)
        - [图解事务](#article-5.6.1.2)
        - 事务的 ACID 特性

            - [原子性 ( Atomicity )](#article-5.6.1.3.1)
            - [一致性 ( Consistency )](#article-5.6.1.3.2)
            - [隔离性 ( Isolation )](#article-5.6.1.3.3)
            - [持久性 ( Durability )](#article-5.6.1.3.4)

        - [实例讲解](#article-5.6.1.4)

    - ##### 5.6.2 并发控制

        - [概述](#article-5.6.2.1)
        - [封锁及其协议](#article-5.6.2.2)
        - [封锁的粒度](#article-5.6.2.3)
        - [活锁和死锁](#article-5.6.2.4)
        - [多版本并发控制](#article-5.6.2.5)

    - ##### 5.6.3 恢复技术

        - [概述](#article-5.6.3.1)
        - [数据转储](#article-5.6.3.2)
        - [登记日志文件](#article-5.6.3.3)
        - [检查点恢复技术](#article-5.6.3.4)

- #### 5.7 安全性

    - [5.7.1 概述](#article-5.7.1)
    - [5.7.2 视图](#article-5.7.2)
    - [5.7.3 审计](#article-5.7.3)

    - 5.7.4 安全控制
        - [用户身份鉴别](#article-5.7.4.1)
        - [存取控制](#article-5.7.4.2)
        - [授权：授予（GRANT）与收回（REVOKE）](#article-5.7.4.3)

    - 5.7.5 数据加密
        - [存储加密](#article-5.7.5.1)
        - [传输加密](#article-5.7.5.2)

<br/>


↑ 索引结束 &nbsp; | &nbsp;[♙回到索引](#article-index)  &nbsp;|&nbsp; 正文开始 ↓

---

<br/>

# 正文

## 1. 前言

- ### <span id="article-1.1">1.1 图解数据库</span>

- ### <span id="article-1.2">1.2 数据库的发展历史</span>

- ### 1.3 数据库的4个基本概念

    - #### <span id="article-1.3.1">1.3.1 数据</span><br/>
        数据是数据库中存储的基本对象。

    - #### <span id="article-1.3.2">1.3.2 数据库</span><br/>
        数据库即是存放数据的仓库。

    - #### <span id="article-1.3.3">1.3.3 数据库管理系统</span><br/>
        数据库管理系统是位于用户与操作系统之间的一层数据管理软件

    - #### <span id="article-1.3.4">1.3.4 数据库系统</span><br/>
        数据库系统是由数据库、数据库管理系统、应用程序和数据库管理员组成的存储、管理、处理和维护数据的系统。

<br/>

## 2. 数据库系统的理解

- ### 2.1 数据模型的概述及分类

    - #### <span id="article-2.1.1">2.1.1 概述</span>
        现有的数据库系统均基于某种数据模型的，数据模型是数据库系统的核心和基础。数据模型是一种模型，是对现实世界数据特征的抽象。也就是说数据模型是用来描述数据，组织数据和对数据进行操作的。<br/>
        在数据模型中有 型（type） 和 值（value）的概念。

    - #### <span id="article-2.1.2">2.1.2 概念模型</span>

    - #### <span id="article-2.1.3">2.1.3 物理模型</span>


- ### 2.2 数据库系统的概述及分类

    - #### <span id="article-2.2.1">2.2.1 层次数据库系统 - 基于层次模型</span><br/>

    - #### <span id="article-2.2.2">2.2.2 网状数据库系统 - 基于网状模型</span>


- ### 2.3 数据库系统的三级模式结构

    - #### <span id="article-2.3.1">2.3.1 概述</span><br/>
        数据库系统的三级模式结构是指数据库系统是由外模式、模式、内模式三级构成的。

    - #### <span id="article-2.3.2">2.3.2 外模式</span><br/>
        外模式也称为子模式（subschema）或用户模式、它是数据库用户能够看见和使用的局部数据的逻辑结构域和特征的描述，是数据库用户的数据视图，是与某一应用有关的数据的逻辑表示

    - #### <span id="article-2.3.3">2.3.3 模式</span><br/>
        模式也称为逻辑模式，是数据库中全体数据的逻辑结构和特征的描述，是所有用户的公共数据视图。

    - #### <span id="article-2.3.4">2.3.4 内模式</span><br/>
        内模式也称为存储模式（storage schema），一个数据库只有一个内模式。它是数据物理结构和存储方式的描述，是数据在数据库内部的组织方式。

- ### 2.4 数据库系统的特点

<br/>

## 3. 非关系型数据库系统（NoSQL）

- ### <span id="article-3.1">3.1 概述</span>

    NoSQL，泛指非关系型的数据库。随着互联网web2.0网站的兴起，传统的关系数据库在应付web2.0网站，特别是超大规模和高并发的SNS类型的web2.0纯动态网站已经显得力不从心，暴露了很多难以克服的问题，而非关系型的数据库则由于其本身的特点得到了非常迅速的发展。NoSQL数据库的产生就是为了解决大规模数据集合多重数据种类带来的挑战，尤其是大数据应用难题。

- ### <span id="article-3.2">3.2 非关系型数据库的特点</span>

    1.&nbsp;不需要预定义模式<br/>
    2.&nbsp;无共享架构<br/>
    3.&nbsp;弹性可扩展<br/>
    4.&nbsp;分区<br/>
    5.&nbsp;异步复制<br/>

- ### <span id="article-3.3">3.3 常用的非关系型数据库</span>

<br/>


## 4. 深入理解关系型数据库系统

- ### 4.1 基础概念

    - #### <span id="article-4.1.1">4.1.1 定义</span>

        关系型数据库系统的定义如此。

    - #### <span id="article-4.1.2">4.1.2 如何理解关系</span>
        关系：现实世界的实体以及实体间的各种联系均用单一的结构类型，即关系来表示。

    - #### 4.1.3 关系模型的三个组成

        - ##### <span id="article-4.1.3.1">关系数据结构</span>
            关系模型的数据结构非常简单

        - ##### <span id="article-4.1.3.2">关系操作集合</span>
            查询（query）、插入（insert）、删除（delete）、修改（update）

        - ##### <span id="article-4.1.3.3">关系完整性约束</span>
            实体完整性、参照完整性、自定义完整性

    - #### 4.1.4 关系模式的数据理论

        - ##### <span id="article-4.1.4.1">什么是关系模式</span>
            在数据库中要区分型和值。在关系数库中，关系模式是型，关系是值。关系模式是对关系的描述 。

        - ##### <span id="article-4.1.4.2">好的关系模式应具有的特点</span>
            - <span id="article-4.1.4.2.1">数据冗余少</span>
            - <span id="article-4.1.4.2.2">插入正常</span>
            - <span id="article-4.1.4.2.3">更新正常</span>
            - <span id="article-4.1.4.2.4">删除正常</span>

        - ##### <span id="article-4.1.4.3">规范化（关系模式的模式分解）</span>
            - <span id="article-4.1.4.3.1">函数依赖</span>
            - <span id="article-4.1.4.3.2">码</span>
            - <span id="article-4.1.4.3.3">范式</span>
            - <span id="article-4.1.4.3.4">2NF</span>
            - <span id="article-4.1.4.3.5">3NF</span>
            - <span id="article-4.1.4.3.6">BCNF</span>
            - <span id="article-4.1.4.3.7">多值依赖</span>
            - <span id="article-4.1.4.3.8">4NF</span>

- ### 4.2 关系的完整性

    - #### <span id="article-4.2.1">4.2.1 概述</sapn>
    - #### <span id="article-4.2.2">4.2.2 实体完整性</span>
    - #### <span id="article-4.2.3">4.2.3 参照完整性</span>
    - #### <span id="article-4.2.4">4.2.4 自定义完整性</span>

- ### 4.3 关系的代数运算

    - #### <span id="article-4.3.1">4.3.1 集合运算</span>

        并运算（∪）、差运算（－）、交运算（∩）、笛卡尔积（×）

    - #### 4.3.2 关系运算

        - ##### <span id="article-4.3.2.1">选择</span>
        - ##### <span id="article-4.3.2.2">投影</span>
        - ##### <span id="article-4.3.2.3">连接</span>
        - ##### <span id="article-4.3.2.4">除</span>


<br/>


## 5. 关系型数据库系统的理论架构

- #### 5.1 完整性
-
    - ##### <span id="article-5.1.1">5.1.1 概述</span>
    - ##### <span id="article-5.1.2">5.1.2 实体完整性</span>
    - ##### <span id="article-5.1.3">5.1.3 参照完整性</span>
    - ##### <span id="article-5.1.4">5.1.4 自定义完整性</span>
    - ##### <span id="article-5.1.5">5.1.5 断言（Assertion）</span>

- #### 5.2 数据存储

    - ##### <span id="article-5.2.1">5.2.1 概述</span>

    - ##### 5.2.2 磁盘存储

        - ###### <span id="article-5.2.2.1">内存缓存</span>
        - ###### <span id="article-5.2.2.2">缓存池</span>

- #### 5.3 数据索引

    - ##### 5.3.1 <span id="article-5.3.1">概述</span>
    - ##### 5.3.2 <span id="article-5.3.2">索引的分类</span>

    - ##### - 5.3.3 索引的实现原理
        - ###### <span id="article-5.3.3.1">B 树索引</span>
        - ###### <span id="article-5.3.3.2">B+ 树索引</span>
        - ###### <span id="article-5.3.3.3">Hash 索引</span>

- #### 5.4 查询处理

    - ##### <span id="article-5.4.1">5.4.1 概述</span>

    - ##### 5.4.2 查询步骤
        - ###### <span id="article-5.4.2.1">查询分析</span>
        - ###### <span id="article-5.4.2.2">查询检查</span>
        - ###### <span id="article-5.4.2.3">查询优化</span>
        - ###### <span id="article-5.4.2.4">查询执行</span>

    - ##### <span id="article-5.4.3">5.4.3 理解查询计划

    - ##### 5.4.4 理解查询优化
        - ###### <span id="article-5.4.4.1">查询优化概述</span>
        - ###### <span id="article-5.4.4.2">实例讲解</span>
        - ###### <span id="article-5.4.4.3">优化方法</span>

- #### 5.5 日志系统

- #### 5.6 事务处理

    - ##### 5.6.1 事务

        - ##### <span id="article-5.6.1.1">概述</span>
        事务是应用程序中一系列严密的操作，所有操作必须成功完成，否则在每个操作中所作的所有更改都会被撤消。也就是事务具有原子性，一个事务中的一系列的操作要么全部成功，要么一个都不做。
        事务的结束有两种，当事务中的所以步骤全部成功执行时，事务提交。如果其中一个步骤失败，将发生回滚操作，撤消撤消之前到事务开始时的所以操作。
        
        - ##### <span id="article-5.6.1.2">图解事务</span>

        - ##### 事务的 ACID 特性
            
            - ###### <span id="article-5.6.1.3.1">原子性 ( Atomicity )</span>
                是指一个事务中包含的所有操作，要么全做，要么全不做。
            
            - ###### <span id="article-5.6.1.3.2">一致性 ( Consistency )</span>
                指数据库从一个一致性状态转移到另一个一致性状态，只包含已提交的事务，如果某些事务尚未完成被迫中断，而该事务对数据库的修改已经写入物理数据库，此时数据库处于一个不正确的状态。
                
                如：比如A向B转账，不可能A扣了钱，B却没收到。

                - ###### 常见的不一致性
                1.更新丢失（丢失修改） 2.不可重复读 3.脏读 4.幻读


            - ###### <span id="article-5.6.1.3.3">隔离性 ( Isolation )</span>
            
                隔离性是指各个事务的执行不能其它事务干扰。即一个事务内部的操作及使用的数据对其它并发事务是隔离的。
    
                隔离级别是指一个事务必须与由其他事务进行的资源或数据更改相隔离的程度。
                
                > 常见的4种隔离级别：
                >
                > ① Read uncommitted（读未提交）
                >
                > ② Read Committed（读取提交内容）
                > 
                > ③ Repeatable Read（可重读）
                > 
                > ④ Serializable（可串行化）
                > 

                事务并发会引起数据的不一致性，故使用不同的隔离级别以保证事务并发下的数据一致性。因此数据的一致性和不同的隔离级别有关，大致如下图。<br>

                <img height="300px" src="https://github.com/Lvsi-China/Sherk/raw/master/extra/image/chapter2/isolationLevel-1.jpeg">

            - ###### <span id="article-5.6.1.3.4">持久性 ( Durability )</span>
            
                在事务完成以后，该事务对数据库所作的更改便持久的保存在数据库之中，并不会被回滚。


- <span id="article-5.6.1.4">实例讲解</span>

    - ##### 5.6.2 并发控制

        - ##### <span id="article-5.6.2.1">概述</span>
            
            - ###### 数据库并发
            原子操作或者事务操作对数据库进行并发操作，如果使用不正当的并发处理，数据就会出现严重的不一致性问题。
            
            - ###### 数据库并发的分类和特点
                数据库的并发操作只有两种：① 并发的原子操作  ② 并发的事务操作 <br>
                这两个不同的并发的操作的特点是：① 原子操作需要我们自己手动封锁
                ② 事务操作则不需要我们手动封锁

        - ##### <span id="article-5.6.2.2">封锁及其协议</span>

            - ###### 封锁
                封锁是实现并发控制的一个非常重要的技术 。基本的封锁类型有2种：① 排他锁（Exclusive），又称为写锁 ② 共享锁（Share），又称为读锁

            - ###### 封锁协议
                在运用 X 锁和 S 锁这两种基本封锁对数据对象加锁时，还需要约定一些规则，例如，何时申请 X 锁 或 S 锁、持续时间、何时释放等。这些规则就称为封锁协议（Locking Protocol）。

                - 一级封锁协议：
                  事务T在修改数据R之前必须先对其加X锁，知道事务结束才释放。事务结束包括正常结束（Commit）和非正常结束（RollBack）

                - 二级封锁协议：
                  在一级封锁协议的基础上上增加事务T在读取数据R之前必须先对其加S锁，读完后即可释放 S 锁 。

                - 三级封锁协议：
                  在一级封锁协议的基础上增加事务T在读取数据R之前必须先对其加S锁，直到事务结束才释放。  

                  <table align="center">
                    <tr>
                        <td rowspan="2" ></td>
                        <td colspan="2" >X 锁</td>
                        <td colspan="2" >S 锁</td>
                        <td colspan="3" >一致性保证</td>
                    </tr>
                    <tr>
                        <td>操作结束释放</td>
                        <td>事务结束释放</td>
                        <td>操作结束释放</td>
                        <td>事务结束释放</td>
                        <td>不丢失修改</td>
                        <td>不读脏数据</td>
                        <td>可重复读</td>
                    </tr>
                    <tr align="center">
                     <td>一级封锁协议</td>
                     <td></td>
                     <td>√</td>
                     <td></td>
                     <td></td>
                     <td>√</td>
                     <td></td>
                     <td></td>
                    </tr>
                    <tr align="center">
                     <td>二级封锁协议</td>
                     <td></td>
                     <td>√</td>
                     <td>√</td>
                     <td></td>
                     <td>√</td>
                     <td>√</td>
                     <td></td>
                    </tr>
                    <tr align="center">
                      <td>三级封锁协议</td>
                      <td></td>
                      <td>√</td>
                      <td></td>
                      <td>√</td>
                      <td>√</td>
                      <td>√</td>
                      <td>√</td>
                    </tr>
                  </table>表格来自《数据库系统概论》第5版 - 王珊
    
                    上述三级协议的主要区别在于什么操作需要申请封锁，以及何时封锁（即持锁时间）。不同的封锁协议是为了保证数据的一致性。
 
        - ##### <span id="article-5.6.2.3">封锁的粒度</span>
        
        封锁对象的大小称为封锁粒度（Granularity）。
        
        封锁的对象可以是逻辑单元，也可以是物理单元。以关系数据库为例子，封锁对象可以是这样一些逻辑单元：属性值、属性值的集合、元组、关系、索引               项、整个索引项直至整个数据库；也可以是这样的一些物理单元：页（数据页或索引页）、物理记录等。
        
        - ##### <span id="article-5.6.2.4">活锁和死锁</span>
        活锁：一直处于等待（一直在做无用功）。
        避免或所的简单方法是采用先来先服务的策略。
        
        死锁：都处于阻塞状态，都在等待对方释放锁。
        - ##### <span id="article-5.6.2.5">多版本并发控制（MultiVersion Concurrency Control，MVCC）</span>
        是指在数据库中通过维护数据对象的多个版本信息来实现高效并发控制的一种策略。
        
        版本（Version）是指数据库中数据对象的一个快照，记录了数据对象某个时刻的状态。
        
    - ##### 5.6.3 恢复技术

        - ###### <span id="article-5.6.3.1">概述</span>
        - ###### <span id="article-5.6.3.2">数据转储</span>
        - ###### <span id="article-5.6.3.3">登记日志文件</span>
        - ###### <span id="article-5.6.3.4">检查点恢复技术</span>

- #### 5.7 安全性

    - ##### <span id="article-5.7.1">5.7.1 概述</span>
    - ##### <span id="article-5.7.2">5.7.2 视图</span>
    - ##### <span id="article-5.7.3">5.7.3 审计</span>

    - ##### 5.7.4 安全控制
        - ###### <span id="article-5.7.4.1">用户身份鉴别]</span>
        - ###### <span id="article-5.7.4.2">存取控制]</span>
        - ###### <span id="article-5.7.4.3">授权：授予（GRANT）与收回（REVOKE）</span>

    - ##### 5.7.5 数据加密
        - ###### <span id="article-5.7.5.1">存储加密</span>
        - ###### <span id="article-5.7.5.2">传输加密</span>




